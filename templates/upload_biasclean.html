<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BiasClean - AI Fairness Engine</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}

    :root {
      --primary:#BE9D04;
      --secondary:#4A463D;
      --accent:#3498db;
      --success:#27ae60;
      --warning:#f39c12;
      --error:#e74c3c;
      --light:#f8f9fa;
      --dark:#323130;
      --gray:#605e5c;

      /* Softer, more professional background */
      --gradient:radial-gradient(circle at top left,#243447 0%,#151824 40%,#05060a 100%);
    }

    body{
      font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
      background:var(--gradient);
      min-height:100vh;
      padding:20px;
      line-height:1.6;
      color:var(--dark);
      -webkit-font-smoothing:antialiased;
    }

    .glass-container{
      max-width:1200px;
      margin:0 auto;
      background:rgba(255,255,255,0.96);
      backdrop-filter:blur(22px);
      border-radius:26px;
      box-shadow:0 28px 60px rgba(0,0,0,0.22);
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.35);
    }

    /* HERO */
    .hero-section{
      background:linear-gradient(135deg,var(--primary),#a88702);
      color:white;
      padding:60px 40px 50px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .hero-section::before{
      content:'';
      position:absolute;
      top:0;left:0;right:0;
      height:4px;
      background:linear-gradient(90deg,var(--secondary),var(--accent),#d4b104);
    }

    /* NEW: sweeping light reflection over hero */
    .hero-section::after{
      content:'';
      position:absolute;
      top:0;
      left:-40%;
      width:40%;
      height:100%;
      background:linear-gradient(
        120deg,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0.45) 45%,
        rgba(255,255,255,0) 100%
      );
      transform:skewX(-20deg);
      animation:heroSweep 7s linear infinite;
      pointer-events:none;
    }

    @keyframes heroSweep{
      0%{transform:translateX(0) skewX(-20deg);}
      100%{transform:translateX(260%) skewX(-20deg);}
    }
    /* END NEW */

    .hero-pattern {
      position:absolute;
      top:0;left:0;right:0;bottom:0;
      background:
        radial-gradient(circle at 20% 80%,rgba(255,255,255,0.18) 0%,transparent 55%),
        radial-gradient(circle at 80% 20%,rgba(255,255,255,0.12) 0%,transparent 55%),
        radial-gradient(circle at 40% 40%,rgba(255,255,255,0.10) 0%,transparent 55%);
      opacity:0.55;
      pointer-events:none;
    }
    .hero-content{position:relative;z-index:2;max-width:760px;margin:0 auto;}

    .broom-icon{
      font-size:4.5em;
      margin-bottom:18px;
      display:block;
      text-shadow:0 4px 12px rgba(0,0,0,0.35);
      animation:float 4s ease-in-out infinite;
      filter:drop-shadow(0 6px 12px rgba(0,0,0,0.35));
    }
    @keyframes float{
      0%,100%{transform:translateY(0) rotate(0deg);}
      33%{transform:translateY(-10px) rotate(-2deg);}
      66%{transform:translateY(-5px) rotate(2deg);}
    }

    .logo{
      font-size:3.1em;
      font-weight:800;
      margin-bottom:6px;
      background:linear-gradient(135deg,#ffffff,#f3f4f6);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      text-shadow:0 2px 10px rgba(0,0,0,0.25);
      letter-spacing:-0.4px;
    }
    .domain-title{
      font-size:2rem;
      font-weight:600;
      margin-bottom:14px;
      text-shadow:0 2px 4px rgba(0,0,0,0.25);
      letter-spacing:0.02em;
    }
    .tagline{
      font-size:1.1rem;
      margin-bottom:26px;
      font-weight:300;
      opacity:0.98;
      max-width:620px;
      margin-left:auto;
      margin-right:auto;
      line-height:1.55;
    }

    .metrics-badge{
      background:rgba(255,255,255,0.16);
      backdrop-filter:blur(18px);
      color:white;
      padding:14px 28px;
      border-radius:999px;
      font-size:0.98rem;
      font-weight:600;
      display:inline-flex;
      align-items:center;
      gap:10px;
      border:1px solid rgba(255,255,255,0.35);
      box-shadow:0 10px 26px rgba(0,0,0,0.25);
      transition:transform 0.25s ease,box-shadow 0.25s ease,background 0.25s ease;
      cursor:pointer;
      text-decoration:none;
      letter-spacing:0.03em;
      text-transform:uppercase;
    }
    .metrics-badge i{font-size:1.05em;}
    .metrics-badge:hover{
      background:rgba(255,255,255,0.26);
      transform:translateY(-3px);
      box-shadow:0 16px 36px rgba(0,0,0,0.35);
    }
    .metrics-badge:focus-visible{
      outline:3px solid #fff;
      outline-offset:3px;
    }

    /* CONTENT */
    .content-section{
      padding:45px 40px 50px;
      max-width:1000px;
      margin:0 auto;
    }

    .description-card{
      background:linear-gradient(135deg,#fdfdfd,#eef1f5);
      padding:32px 34px;
      border-radius:20px;
      margin-bottom:44px;
      border-left:6px solid var(--secondary);
      box-shadow:0 14px 40px rgba(0,0,0,0.08);
      position:relative;
      overflow:hidden;
    }
    .description-card::before{
      content:'';
      position:absolute;
      top:-20px;right:-30px;
      width:140px;height:140px;
      background:radial-gradient(circle,var(--primary) 0%,transparent 70%);
      opacity:0.12;
    }
    .description-title{
      color:var(--dark);
      font-size:1.35rem;
      margin-bottom:12px;
      font-weight:650;
      display:flex;
      align-items:center;
      gap:12px;
      letter-spacing:0.01em;
    }
    .description-title i{
      color:var(--secondary);
      font-size:1.15em;
    }
    .description-text{
      color:var(--gray);
      font-size:1.02rem;
      line-height:1.7;
      max-width:95%;
    }

    /* UPLOAD CARD */
    .upload-card{
      background:white;
      border-radius:22px;
      padding:42px 34px 40px;
      text-align:center;
      box-shadow:0 22px 55px rgba(0,0,0,0.14);
      border:1px solid rgba(190,157,4,0.25);
      transition:transform 0.35s ease,box-shadow 0.35s ease,border-color 0.35s ease;
      position:relative;
      overflow:hidden;
      isolation:isolate;
    }
    .upload-card::before{
      content:'';
      position:absolute;
      top:-60%;left:-60%;
      width:220%;height:220%;
      background:conic-gradient(transparent,transparent,transparent,rgba(190,157,4,0.75));
      animation:rotate 6s linear infinite;
      opacity:0.55;
    }
    .upload-card::after{
      content:'';
      position:absolute;
      inset:5px;
      background:white;
      border-radius:18px;
      z-index:-1;
    }
    .upload-card:hover{
      transform:translateY(-6px);
      box-shadow:0 26px 60px rgba(0,0,0,0.20);
      border-color:rgba(190,157,4,0.6);
    }
    @keyframes rotate{
      0%{transform:rotate(0deg);}
      100%{transform:rotate(360deg);}
    }

    .upload-content{position:relative;z-index:2;}
    .upload-icon{
      font-size:3.8em;
      color:var(--primary);
      margin-bottom:16px;
      filter:drop-shadow(0 4px 8px rgba(190,157,4,0.35));
    }
    .upload-title{
      color:var(--dark);
      font-size:1.55rem;
      margin-bottom:8px;
      font-weight:650;
      letter-spacing:0.02em;
    }
    .upload-subtitle{
      color:var(--gray);
      font-size:1rem;
      margin-bottom:26px;
      max-width:520px;
      margin-left:auto;
      margin-right:auto;
    }

    .domain-selection{margin:24px 0 26px;text-align:center;}
    .domain-label{
      display:block;
      color:var(--dark);
      font-size:1.02rem;
      font-weight:600;
      margin-bottom:10px;
      letter-spacing:0.02em;
    }
    .domain-label i{margin-right:8px;}

    .domain-select{
      background:white;
      border:2px solid rgba(190,157,4,0.75);
      border-radius:14px;
      padding:14px 22px;
      font-size:1rem;
      color:var(--dark);
      font-weight:600;
      cursor:pointer;
      transition:all 0.25s ease;
      min-width:280px;
      box-shadow:0 8px 20px rgba(190,157,4,0.25);
      appearance:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%234A463D' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:right 18px center;
      background-size:16px;
    }
    .domain-select:focus{
      outline:none;
      border-color:var(--secondary);
      box-shadow:0 10px 26px rgba(74,70,61,0.32);
      transform:translateY(-1px);
    }
    .domain-select:focus-visible{
      outline:3px solid var(--secondary);
      outline-offset:3px;
    }

    .domain-info{
      margin-top:10px;
      color:var(--gray);
      font-size:0.92rem;
      font-style:italic;
      max-width:420px;
      margin-left:auto;
      margin-right:auto;
      transition:color 0.3s ease;
    }

    .file-upload-container{
      display:inline-block;
      padding:8px;
      border-radius:999px;
      transition:all 0.25s ease;
    }
    .file-upload-container:hover{
      transform:translateY(-3px);
      box-shadow:0 14px 30px rgba(190,157,4,0.35);
    }

    .file-input-wrapper{
      position:relative;
      display:inline-block;
      cursor:pointer;
    }
    .file-input{
      opacity:0;
      position:absolute;
      left:0;top:0;
      height:100%;width:100%;
      cursor:pointer;
    }
    .file-input-label{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      background:linear-gradient(135deg,var(--primary),#a88702);
      color:white;
      border-radius:999px;
      font-size:0.98rem;
      font-weight:800;
      padding:16px 38px;
      text-transform:uppercase;
      letter-spacing:0.07em;
      transition:all 0.25s ease;
      box-shadow:0 8px 20px rgba(190,157,4,0.45);
      border:1px solid rgba(255,255,255,0.35);
    }
    .file-input-label:hover{
      background:linear-gradient(135deg,#a88702,var(--primary));
      transform:translateY(-2px);
      box-shadow:0 12px 26px rgba(190,157,4,0.6);
    }
    .file-input-label:focus-visible{
      outline:3px solid var(--accent);
      outline-offset:4px;
    }
    .file-input-label i{font-size:1.1em;}

    .file-name{
      display:block;
      margin-top:10px;
      color:var(--success);
      font-weight:600;
      font-size:0.9rem;
      transition:color 0.3s ease;
    }

    .submit-btn{
      background:linear-gradient(135deg,var(--secondary),#3a3731);
      color:white;
      border:none;
      padding:18px 56px;
      font-size:1.05rem;
      font-weight:800;
      border-radius:999px;
      cursor:pointer;
      transition:all 0.25s ease;
      box-shadow:0 14px 30px rgba(74,70,61,0.45);
      text-transform:uppercase;
      letter-spacing:0.12em;
      position:relative;
      overflow:hidden;
      margin-top:26px;
    }
    .submit-btn i{margin-right:8px;}
    .submit-btn::before{
      content:'';
      position:absolute;
      top:0;left:-100%;
      width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);
      transition:left 0.55s;
    }
    .submit-btn:hover::before{left:100%;}
    .submit-btn:hover{
      transform:translateY(-3px);
      box-shadow:0 20px 46px rgba(74,70,61,0.65);
      background:linear-gradient(135deg,#3a3731,var(--secondary));
    }
    .submit-btn:focus-visible{
      outline:3px solid var(--accent);
      outline-offset:4px;
    }
    .submit-btn:disabled{
      background:var(--gray);
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    /* Progress Bar Styles */
    .progress-container {
      display: none;
      margin: 24px auto;
      max-width: 500px;
      background: rgba(255,255,255,0.9);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      border: 1px solid rgba(190,157,4,0.2);
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: #e0e0e0;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 8px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), #a88702);
      border-radius: 6px;
      width: 0%;
      transition: width 0.5s ease;
      box-shadow: 0 2px 8px rgba(190,157,4,0.4);
    }

    .progress-text {
      text-align: center;
      color: var(--secondary);
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 8px;
    }

    .eta-text {
      text-align: center;
      color: var(--gray);
      font-size: 0.85rem;
      font-style: italic;
    }

    .loading-spinner{
      display:none;
      margin:18px auto 0;
      text-align:center;
      color:var(--gray);
      font-size:0.95rem;
    }
    .spinner{
      border:4px solid #f3f3f3;
      border-top:4px solid var(--primary);
      border-radius:50%;
      width:38px;height:38px;
      animation:spin 1.4s linear infinite;
      margin:0 auto 8px;
    }
    @keyframes spin{
      0%{transform:rotate(0deg);}
      100%{transform:rotate(360deg);}
    }

    /* Error/Success Message Styles */
    .message-container {
      display: none;
      margin: 20px auto;
      max-width: 500px;
      padding: 18px 24px;
      border-radius: 16px;
      text-align: center;
      font-weight: 600;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      animation: slideIn 0.4s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .success-message {
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
      color: #155724;
      border: 2px solid #c3e6cb;
      border-left: 6px solid var(--success);
    }

    .error-message {
      background: linear-gradient(135deg, #f8d7da, #f5c6cb);
      color: #721c24;
      border: 2px solid #f5c6cb;
      border-left: 6px solid var(--error);
    }

    .warning-message {
      background: linear-gradient(135deg, #fff3cd, #ffeaa7);
      color: #856404;
      border: 2px solid #ffeaa7;
      border-left: 6px solid var(--warning);
    }

    .results-section{
      display:none;
      margin-top:36px;
      padding:30px 26px;
      background:linear-gradient(135deg,#f9fbff,#edf1f7);
      border-radius:20px;
      border-left:6px solid var(--success);
      box-shadow:0 14px 40px rgba(0,0,0,0.08);
      animation: slideIn 0.6s ease-out;
    }

    /* FEATURES GRID */
    .features-section{margin-top:44px;}
    .features-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
      gap:26px;
      margin:0;
    }
    .feature-card{
      background:white;
      padding:34px 26px 30px;
      border-radius:20px;
      text-align:center;
      box-shadow:0 14px 40px rgba(0,0,0,0.08);
      transition:transform 0.3s ease,box-shadow 0.3s ease;
      border-top:4px solid var(--primary);
      cursor:pointer;
      position:relative;
      overflow:hidden;
    }
    .feature-card::before{
      content:'';
      position:absolute;
      top:0;left:0;right:0;
      height:4px;
      background:linear-gradient(90deg,var(--primary),var(--accent),var(--secondary));
      transform:scaleX(0);
      transform-origin:left;
      transition:transform 0.25s ease;
    }
    .feature-card:hover::before{transform:scaleX(1);}
    .feature-card:hover{
      transform:translateY(-8px);
      box-shadow:0 24px 50px rgba(0,0,0,0.16);
    }
    .feature-icon{
      font-size:3.2em;
      margin-bottom:18px;
      color:var(--primary);
      transition:all 0.25s ease;
    }
    .feature-card:hover .feature-icon{
      color:var(--secondary);
      transform:scale(1.08);
    }
    .feature-title{
      color:var(--dark);
      font-size:1.32rem;
      margin-bottom:10px;
      font-weight:700;
      letter-spacing:0.02em;
    }
    .feature-description{
      color:var(--gray);
      line-height:1.6;
      font-size:0.98rem;
    }
    .feature-card a{
      text-decoration:none;
      color:inherit;
      display:block;
      width:100%;
      height:100%;
    }

    /* LEGAL / TECH CARD */
    .legal-section{
      background:linear-gradient(135deg,#fff7e0,#ffefc4);
      border:1px solid var(--warning);
      border-radius:18px;
      padding:30px 26px;
      margin-top:46px;
      position:relative;
      border-left:6px solid var(--warning);
      cursor:pointer;
      transition:all 0.25s ease;
      box-shadow:0 10px 30px rgba(0,0,0,0.06);
    }
    .legal-section:hover{
      background:linear-gradient(135deg,#ffefc4,#fff7e0);
      transform:translateY(-4px);
      box-shadow:0 16px 38px rgba(0,0,0,0.12);
    }
    .legal-icon{
      position:absolute;
      top:-18px;left:30px;
      background:white;
      padding:10px;
      border-radius:50%;
      box-shadow:0 6px 18px rgba(0,0,0,0.12);
      color:var(--warning);
      font-size:1.15em;
    }
    .legal-title{
      color:#856404;
      font-weight:700;
      margin-bottom:8px;
      font-size:1.18rem;
      letter-spacing:0.02em;
    }
    .legal-text{
      color:#856404;
      line-height:1.6;
      font-size:0.96rem;
    }
    .legal-section a{
      text-decoration:none;
      color:inherit;
      display:block;
      width:100%;
      height:100%;
    }

    /* RESPONSIVE */
    @media(max-width:900px){
      .content-section{
        padding:32px 22px 36px;
      }
      .description-card{
        padding:26px 22px;
      }
      .upload-card{
        padding:32px 22px 30px;
      }
    }

    @media(max-width:768px){
      .glass-container{
        margin:10px;
        border-radius:20px;
      }
      .hero-section{
        padding:34px 18px 30px;
      }
      .logo{font-size:2.4em;}
      .broom-icon{font-size:3.5em;}
      .domain-title{font-size:1.5rem;}
      .tagline{
        font-size:1rem;
        padding:0 6px;
      }
      .metrics-badge{
        font-size:0.86rem;
        padding:11px 20px;
      }
      .domain-select{min-width:240px;}
      .features-grid{grid-template-columns:1fr;}
    }

    @media(max-width:480px){
      body{padding:12px;}
      .upload-title{font-size:1.3rem;}
      .file-input-label{
        padding:14px 26px;
        font-size:0.9rem;
      }
      .submit-btn{
        width:100%;
        padding:16px 20px;
      }
    }
  </style>
</head>
<body>
<div class="glass-container">
  <!-- HERO -->
  <div class="hero-section">
    <div class="hero-pattern"></div>
    <div class="hero-content">
      <div class="broom-icon">üßπ</div>
      <div class="logo">BiasClean</div>
      <div class="domain-title">AI Fairness Engine</div>
      <div class="tagline">Sweep away biases from your datasets with evidence-based precision and industry-grade mitigation</div>
      <a href="/bias-clean-7-domain-specific-weight-matrices" class="metrics-badge">
        <i class="fas fa-cogs"></i> 7 Domain-Specific Weight Matrices
      </a>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content-section">
    <div class="description-card">
      <div class="description-title">
        <i class="fas fa-shield-alt" style="color:#4A463D;"></i>
        Evidence-Based Bias Mitigation ‚Ä¢ Industry-Grade SMOTE ‚Ä¢ Production Ready
      </div>
      <div class="description-text">
        BiasClean v2.0 uses mathematical proof of biases for surgical distribution alignment. 
        Upload your dataset to detect and mitigate biases across 7 protected features with 
        industry-grade SMOTE rebalancing that guarantees ‚â§8% data loss while achieving 
        meaningful fairness improvements.
      </div>
    </div>

    <!-- Message Containers -->
    <div class="message-container success-message" id="successMessage"></div>
    <div class="message-container error-message" id="errorMessage"></div>
    <div class="message-container warning-message" id="warningMessage"></div>

    <!-- Progress Bar -->
    <div class="progress-container" id="progressContainer">
      <div class="progress-text" id="progressText">Processing: 0%</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="eta-text" id="etaText">Estimated time: 1-3 minutes</div>
    </div>

    <!-- UPLOAD FORM -->
    <div class="upload-section">
      <form id="uploadForm">
        <div class="upload-card">
          <div class="upload-content">
            <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
            <div class="upload-title">Upload Your Dataset</div>
            <div class="upload-subtitle">Select a CSV file and domain for comprehensive bias analysis and mitigation</div>

            <!-- Domain Selection -->
            <div class="domain-selection">
              <label class="domain-label">
                <i class="fas fa-globe"></i> Select Analysis Domain
              </label>
              <select class="domain-select" name="domain" id="domainSelect" required>
                <option value="">Choose a domain...</option>
                <option value="justice">‚öñÔ∏è Justice System</option>
                <option value="health">üè• Healthcare</option>
                <option value="finance">üíº Finance & Banking</option>
                <option value="education">üéì Education</option>
                <option value="hiring">üë• Hiring & Recruitment</option>
                <option value="business">üè¢ Business Operations</option>
                <option value="governance">üèõÔ∏è Governance & Public Policy</option>
              </select>
              <div class="domain-info" id="domainInfo">
                Domain determines feature weights and bias detection priorities
              </div>
            </div>

            <!-- File Upload -->
            <div class="file-upload-container">
              <div class="file-input-wrapper">
                <label for="datasetFile" class="file-input-label">
                  <i class="fas fa-file-csv"></i> Choose CSV File
                </label>
                <input type="file" name="file" accept=".csv" required class="file-input" id="datasetFile" />
              </div>
              <span class="file-name" id="fileName"></span>
            </div>

            <br /><br />
            <small style="color:#4A463D;">Accepted format: CSV only (max 50MB). Remove personal identifiers (names, IDs).</small><br />
            
            <!-- Submit Button -->
            <button type="submit" class="submit-btn" id="submitBtn">
              <i class="fas fa-play-circle"></i> Start BiasClean Audit
            </button>

            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
              <div class="spinner"></div>
              <div>Processing your dataset... This may take a few minutes</div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- Results Section -->
    <div class="results-section" id="resultsSection">
      <h2 style="color: var(--success); margin-bottom: 20px;">
        <i class="fas fa-check-circle"></i> Analysis Complete!
      </h2>
      <div id="resultsContent"></div>
    </div>

    <!-- FEATURES -->
    <div class="features-section">
      <div class="features-grid">
        <div class="feature-card">
          <a href="/bias-clean-evidence-based-detection">
            <div class="feature-icon"><i class="fas fa-search-plus"></i></div>
            <div class="feature-title">Evidence-Based Detection</div>
            <div class="feature-description">
              Mathematical proof of biases using chi-square tests and statistical significance 
              with p-values and effect sizes for each protected feature.
            </div>
          </a>
        </div>

        <div class="feature-card">
          <a href="/bias-clean-industry-grade-smote">
            <div class="feature-icon"><i class="fas fa-industry"></i></div>
            <div class="feature-title">Industry-Grade SMOTE</div>
            <div class="feature-description">
              Production-ready rebalancing with ‚â§8% data loss guarantee. Intelligent duplication 
              and controlled undersampling for optimal fairness-data retention balance.
            </div>
          </a>
        </div>

        <div class="feature-card">
          <a href="/bias-clean-comprehensive-analytics">
            <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
            <div class="feature-title">Comprehensive Analytics</div>
            <div class="feature-description">
              Professional visualizations, detailed reports, and industry validation metrics. 
              Wasserstein distance improvements and production readiness scoring.
            </div>
          </a>
        </div>
      </div>
    </div>

    <!-- DISCLAIMER / TECH IMPLEMENTATION -->
    <div class="legal-section">
      <a href="/bias-clean-technical-implementation">
        <!-- Put this exactly here -->
        <div class="legal-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>

        <div class="legal-content">
          <div class="legal-title">Technical Implementation</div>
          <div class="legal-text">
            BiasClean v2.0 implements domain-specific weight matrices based on UK regulatory frameworks. 
            Protected features: Ethnicity, Gender, Age, DisabilityStatus, SocioeconomicStatus, Region, MigrationStatus. 
            Analysis includes statistical significance testing (Œ±=0.05) and effect size calculations.
          </div>
        </div>
      </a>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const fileInput = document.getElementById('datasetFile');
  const fileName = document.getElementById('fileName');
  const domainSelect = document.getElementById('domainSelect');
  const domainInfo = document.getElementById('domainInfo');
  const uploadForm = document.getElementById('uploadForm');
  const submitBtn = document.getElementById('submitBtn');
  const loadingSpinner = document.getElementById('loadingSpinner');
  const resultsSection = document.getElementById('resultsSection');
  const resultsContent = document.getElementById('resultsContent');
  const progressContainer = document.getElementById('progressContainer');
  const progressText = document.getElementById('progressText');
  const progressFill = document.getElementById('progressFill');
  const etaText = document.getElementById('etaText');
  const successMessage = document.getElementById('successMessage');
  const errorMessage = document.getElementById('errorMessage');
  const warningMessage = document.getElementById('warningMessage');

  // Hide message containers initially
  successMessage.style.display = 'none';
  errorMessage.style.display = 'none';
  warningMessage.style.display = 'none';

  // Domain descriptions
  const domainDescriptions = {
    'justice': '‚öñÔ∏è Justice: Highest priority: Ethnicity (25%), SocioeconomicStatus (20%). Analyzes recidivism, sentencing, and arrest disparities.',
    'health': 'üè• Healthcare: Highest priority: Ethnicity (25%), SocioeconomicStatus (20%). Analyzes diagnosis rates, treatment access, and outcomes.',
    'finance': 'üíº Finance: Highest priority: SocioeconomicStatus (30%), Ethnicity (20%). Analyzes loan approvals, credit scoring, and financial inclusion.',
    'education': 'üéì Education: Highest priority: SocioeconomicStatus (25%), Ethnicity (20%). Analyzes admissions, grading, and educational attainment.',
    'hiring': 'üë• Hiring: Highest priority: Ethnicity (25%), Gender (20%). Analyzes recruitment, promotions, and workplace equity.',
    'business': 'üè¢ Business: Highest priority: Ethnicity (25%), Gender (20%). Analyzes funding, contracts, and business opportunities.',
    'governance': 'üèõÔ∏è Governance: Highest priority: Ethnicity (25%), Gender (20%). Analyzes elections, appointments, and political representation.'
  };

  // File input handler
  fileInput.addEventListener('change', function(e){
    if(e.target.files.length > 0){
      const file = e.target.files[0];
      
      // Validate file type
      if (!file.name.toLowerCase().endsWith('.csv')) {
        showMessage('error', 'Error: Please select a CSV file (.csv extension required)');
        fileInput.value = '';
        fileName.textContent = '';
        fileName.style.color = 'var(--error)';
        return;
      }
      
      // Validate file size (50MB limit)
      const maxSize = 50 * 1024 * 1024; // 50MB in bytes
      if (file.size > maxSize) {
        showMessage('error', `File too large: ${(file.size / (1024*1024)).toFixed(1)}MB. Maximum size is 50MB.`);
        fileInput.value = '';
        fileName.textContent = '';
        fileName.style.color = 'var(--error)';
        return;
      }
      
      // Check if file is empty
      if (file.size === 0) {
        showMessage('error', 'Error: File is empty. Please select a valid CSV file.');
        fileInput.value = '';
        fileName.textContent = '';
        fileName.style.color = 'var(--error)';
        return;
      }
      
      fileName.textContent = '‚úÖ Selected: ' + file.name + ' (' + formatFileSize(file.size) + ')';
      fileName.style.color = 'var(--success)';
      
      // Hide any previous error messages
      hideMessage('error');
    } else {
      fileName.textContent = '';
    }
  });

  // Domain selection handler
  domainSelect.addEventListener('change', function(e){
    const selectedDomain = e.target.value;
    if (selectedDomain && domainDescriptions[selectedDomain]) {
      domainInfo.textContent = domainDescriptions[selectedDomain];
      domainInfo.style.color = 'var(--secondary)';
      domainInfo.style.fontWeight = '600';
    } else {
      domainInfo.textContent = 'Domain determines feature weights and bias detection priorities';
      domainInfo.style.color = 'var(--gray)';
      domainInfo.style.fontWeight = 'normal';
    }
  });

  // Form submission handler
  uploadForm.addEventListener('submit', async function(e){
    e.preventDefault();
    
    // Validation
    if (!fileInput.files[0]) {
      showMessage('error', 'Please select a CSV file to upload.');
      return;
    }
    
    if (!domainSelect.value) {
      showMessage('error', 'Please select an analysis domain.');
      return;
    }
    
    const file = fileInput.files[0];
    
    // Final validation
    if (!file.name.toLowerCase().endsWith('.csv')) {
      showMessage('error', 'Only CSV files are accepted. Please select a .csv file.');
      return;
    }
    
    // Prepare form data
    const formData = new FormData();
    formData.append('file', file);
    formData.append('domain', domainSelect.value);

    // Show loading, disable submit
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    loadingSpinner.style.display = 'block';
    progressContainer.style.display = 'block';
    resultsSection.style.display = 'none';
    
    // Hide any existing messages
    hideAllMessages();
    
    // Update progress bar
    updateProgress(10, 'Validating file...');
    
    try {
      // Test backend connection first
      updateProgress(20, 'Connecting to BiasClean service...');
      
      try {
        const healthCheck = await fetch('https://biasclean.onrender.com/health', {
          method: 'GET',
          signal: AbortSignal.timeout(10000) // 10 second timeout
        });
        
        if (!healthCheck.ok) {
          throw new Error('Service unavailable');
        }
      } catch (healthError) {
        updateProgress(0, '');
        showMessage('error', 'Cannot connect to BiasClean service. Please ensure the backend is running on Render.com.');
        resetForm();
        return;
      }
      
      // Upload file
      updateProgress(30, 'Uploading file...');
      
      const xhr = new XMLHttpRequest();
      
      // Progress tracking
      xhr.upload.addEventListener('progress', (e) => {
        if (e.lengthComputable) {
          const uploadPercent = Math.round((e.loaded / e.total) * 30); // Upload is 30% of total
          updateProgress(30 + uploadPercent, 'Uploading...');
        }
      });
      
      // Create promise for XHR
      const uploadPromise = new Promise((resolve, reject) => {
        xhr.open('POST', 'https://biasclean.onrender.com/biasclean/biasclean-audit');
        xhr.setRequestHeader('Accept', 'application/json');
        
        xhr.onload = function() {
          if (xhr.status >= 200 && xhr.status < 300) {
            try {
              const response = JSON.parse(xhr.responseText);
              resolve(response);
            } catch (parseError) {
              reject(new Error('Invalid response from server'));
            }
          } else {
            reject(new Error(`Server error: ${xhr.status}`));
          }
        };
        
        xhr.onerror = function() {
          reject(new Error('Network error occurred'));
        };
        
        xhr.ontimeout = function() {
          reject(new Error('Request timeout'));
        };
        
        xhr.timeout = 300000; // 5 minute timeout
        xhr.send(formData);
      });
      
      // Wait for upload to complete
      updateProgress(70, 'Analyzing biases...');
      const result = await uploadPromise;
      
      // Processing complete
      updateProgress(100, 'Analysis complete!');
      
      // Show success message
      showMessage('success', '‚úÖ Bias analysis completed successfully!');
      
      // Display results after short delay
      setTimeout(() => {
        displayResults(result);
        resultsSection.style.display = 'block';
        resultsSection.scrollIntoView({ behavior: 'smooth' });
      }, 1000);
      
    } catch (error) {
      console.error('Upload error:', error);
      updateProgress(0, '');
      
      // User-friendly error messages
      let errorMsg = 'Processing failed: ';
      if (error.message.includes('timeout')) {
        errorMsg += 'Request timeout. The file might be too large or server is busy.';
      } else if (error.message.includes('Network error')) {
        errorMsg += 'Network connection failed. Please check your internet.';
      } else if (error.message.includes('Server error')) {
        errorMsg += 'Server error. Please try again later.';
      } else {
        errorMsg += error.message;
      }
      
      showMessage('error', errorMsg);
      
    } finally {
      resetForm();
    }
  });

  // Helper functions
  function updateProgress(percent, message) {
    progressFill.style.width = percent + '%';
    progressText.textContent = message || `Processing: ${percent}%`;
    
    // Update ETA based on progress
    if (percent < 30) {
      etaText.textContent = 'Estimated time: 2-3 minutes remaining';
    } else if (percent < 70) {
      etaText.textContent = 'Estimated time: 1-2 minutes remaining';
    } else if (percent < 90) {
      etaText.textContent = 'Estimated time: Less than 1 minute remaining';
    } else {
      etaText.textContent = 'Finishing up...';
    }
  }

  function showMessage(type, message) {
    // Hide all messages first
    hideAllMessages();
    
    // Show the requested message
    if (type === 'success') {
      successMessage.textContent = message;
      successMessage.style.display = 'block';
    } else if (type === 'error') {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
    } else if (type === 'warning') {
      warningMessage.textContent = message;
      warningMessage.style.display = 'block';
    }
  }

  function hideMessage(type) {
    if (type === 'success') {
      successMessage.style.display = 'none';
    } else if (type === 'error') {
      errorMessage.style.display = 'none';
    } else if (type === 'warning') {
      warningMessage.style.display = 'none';
    }
  }

  function hideAllMessages() {
    successMessage.style.display = 'none';
    errorMessage.style.display = 'none';
    warningMessage.style.display = 'none';
  }

  function resetForm() {
    submitBtn.disabled = false;
    submitBtn.innerHTML = '<i class="fas fa-play-circle"></i> Start BiasClean Audit';
    loadingSpinner.style.display = 'none';
    progressContainer.style.display = 'none';
  }

  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  function displayResults(data) {
    // Check if data has expected structure
    if (!data || typeof data !== 'object') {
      resultsContent.innerHTML = `
        <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.08);">
          <h3 style="color: var(--error); margin-bottom: 15px;">
            <i class="fas fa-exclamation-triangle"></i> Results Unavailable
          </h3>
          <p>Unable to display results. The server returned an unexpected response.</p>
          <p>Please try again or contact support if the issue persists.</p>
        </div>
      `;
      return;
    }
    
    // Use data from your pipeline or provide default structure
    const detection = data.detection || { n_rows: 'N/A', n_columns: 'N/A', significant_biases: 'N/A' };
    const removal = data.removal || { 
      bias_reduction_percent: 0, 
      data_retention_percent: 100, 
      production_ready: false 
    };
    const files = data.files || { 
      corrected: 'corrected_dataset.csv', 
      report: 'bias_report.html', 
      validation: 'validation.json' 
    };
    const session_id = data.session_id || 'default_session';
    const report_content = data.report_content || 'Analysis report will be available for download.';
    
    let html = `
      <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.08);">
        <h3 style="color: var(--primary); margin-bottom: 15px;">
          <i class="fas fa-chart-bar"></i> Executive Summary
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid var(--primary);">
            <div style="font-size: 1.8em; font-weight: bold; color: var(--primary);">${detection.n_rows}</div>
            <div style="color: var(--gray);">Records Analyzed</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid var(--success);">
            <div style="font-size: 1.8em; font-weight: bold; color: var(--success);">${removal.bias_reduction_percent.toFixed(1)}%</div>
            <div style="color: var(--gray);">Bias Reduction</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid var(--accent);">
            <div style="font-size: 1.8em; font-weight: bold; color: var(--accent);">${removal.data_retention_percent.toFixed(1)}%</div>
            <div style="color: var(--gray);">Data Retention</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid ${removal.production_ready ? 'var(--success)' : 'var(--warning)'};">
            <div style="font-size: 1.8em; font-weight: bold; color: ${removal.production_ready ? 'var(--success)' : 'var(--warning)'};">
              ${removal.production_ready ? '‚úÖ' : '‚ö†Ô∏è'}
            </div>
            <div style="color: var(--gray);">Production Ready</div>
          </div>
        </div>
      </div>

      <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.08);">
        <h3 style="color: var(--primary); margin-bottom: 15px;">
          <i class="fas fa-download"></i> Download Results
        </h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <a href="https://biasclean.onrender.com/biasclean/download/${session_id}/${files.corrected}" 
             class="download-btn" 
             style="background: var(--success); color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3); display: inline-flex; align-items: center; gap: 8px;">
            <i class="fas fa-file-csv"></i> Corrected Dataset
          </a>
          <a href="https://biasclean.onrender.com/biasclean/download/${session_id}/${files.report}" 
             class="download-btn" 
             style="background: var(--accent); color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3); display: inline-flex; align-items: center; gap: 8px;">
            <i class="fas fa-file-alt"></i> Full Report
          </a>
          <a href="https://biasclean.onrender.com/biasclean/download/${session_id}/${files.validation}" 
             class="download-btn" 
             style="background: var(--secondary); color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(74, 70, 61, 0.3); display: inline-flex; align-items: center; gap: 8px;">
            <i class="fas fa-chart-bar"></i> Validation Data
          </a>
        </div>
        <p style="margin-top: 15px; color: var(--gray); font-size: 0.9em;">
          <i class="fas fa-info-circle"></i> Downloads will be available for 24 hours. Save files locally for permanent access.
        </p>
      </div>

      <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.08);">
        <h3 style="color: var(--primary); margin-bottom: 15px;">
          <i class="fas fa-file-alt"></i> Analysis Details
        </h3>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid var(--primary);">
          <p><strong>Domain Analyzed:</strong> ${domainSelect.options[domainSelect.selectedIndex].text}</p>
          <p><strong>File Processed:</strong> ${fileInput.files[0].name}</p>
          <p><strong>Processing Time:</strong> ${new Date().toLocaleTimeString()}</p>
          <p><strong>Significant Biases Found:</strong> ${detection.significant_biases}</p>
          <p><strong>Data Retention:</strong> ${removal.data_retention_percent.toFixed(1)}% of original data preserved</p>
          <p><strong>Recommendation:</strong> ${removal.production_ready ? '‚úÖ Dataset is production ready' : '‚ö†Ô∏è Review bias findings before production use'}</p>
        </div>
      </div>
    `;

    resultsContent.innerHTML = html;
  }
});
</script>
</body>
</html>